(()=>{"use strict";var e={827:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createResponse=void 0,o.createResponse=(e,o)=>({statusCode:e,body:JSON.stringify(o)})},743:function(e,o,r){var t=this&&this.__awaiter||function(e,o,r,t){return new(r||(r=Promise))((function(i,n){function s(e){try{c(t.next(e))}catch(e){n(e)}}function l(e){try{c(t.throw(e))}catch(e){n(e)}}function c(e){var o;e.done?i(e.value):(o=e.value,o instanceof r?o:new r((function(e){e(o)}))).then(s,l)}c((t=t.apply(e,o||[])).next())}))};Object.defineProperty(o,"__esModule",{value:!0}),o.createUserPoolAndAppClient=o.cognitoIdentityServiceProvider=void 0;const i=r(336),n=r(259);o.cognitoIdentityServiceProvider=new i.CognitoIdentityServiceProvider({region:n.cognitoUserPoolRegion,apiVersion:"2016-04-18"}),o.createUserPoolAndAppClient=()=>t(void 0,void 0,void 0,(function*(){try{i.config.update({region:n.cognitoUserPoolRegion});const l=(yield(s=n.cognitoUserPoolName,t(void 0,void 0,void 0,(function*(){var e;try{const r=null===(e=(yield o.cognitoIdentityServiceProvider.listUserPools({MaxResults:10}).promise()).UserPools)||void 0===e?void 0:e.find((e=>e.Name===s));if(!r)throw new Error(`User Pool ${s} wasn't found`);return r.Id}catch(e){return void console.error("Error checking for existing User Pool:",e)}}))))||(yield(e=n.cognitoUserPoolName,t(void 0,void 0,void 0,(function*(){var t;try{const i=Object.assign({PoolName:e,Policies:{PasswordPolicy:{MinimumLength:8,RequireUppercase:!0,RequireLowercase:!0,RequireNumbers:!0,RequireSymbols:!1}}},r);return null===(t=(yield o.cognitoIdentityServiceProvider.createUserPool(i).promise()).UserPool)||void 0===t?void 0:t.Id}catch(e){return void console.error("Error checking for existing User Pool:",e)}}))));if(!l)throw new Error(`User Pool ${n.cognitoUserPoolName} did not found or created`);const c=(yield((e,r)=>t(void 0,void 0,void 0,(function*(){var t;try{const i=null===(t=(yield o.cognitoIdentityServiceProvider.listUserPoolClients({UserPoolId:e}).promise()).UserPoolClients)||void 0===t?void 0:t.find((e=>e.ClientName===r));if(i)return i.ClientId}catch(e){return void console.error("Error checking for existing User Pool:",e)}})))(l,n.cognitoUserPoolAppClientName))||(yield(e=>t(void 0,void 0,void 0,(function*(){var r;try{const t={UserPoolId:e,ClientName:n.cognitoUserPoolAppClientName,GenerateSecret:!1,AllowedOAuthFlowsUserPoolClient:!0,AllowedOAuthFlows:["code","implicit"],AllowedOAuthScopes:["phone","email","openid","profile"],ExplicitAuthFlows:[process.env.AUTH_FLOW_TYPE||"ALLOW_USER_PASSWORD_AUTH"],CallbackURLs:["http://localhost:3000/callback"],LogoutURLs:["http://localhost:3000/logout"]};return null===(r=(yield o.cognitoIdentityServiceProvider.createUserPoolClient(t).promise()).UserPoolClient)||void 0===r?void 0:r.ClientId}catch(e){return void console.error("Error checking for existing User Pool:",e)}})))(l));return{userPoolId:l,appClientId:c}}catch(e){console.error("Error creating User Pool:",e)}var e,r,s}))},259:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.cognitoUserPoolAppClientName=o.cognitoUserPoolRegion=o.cognitoUserPoolId=o.cognitoUserPoolName=void 0,o.cognitoUserPoolName="guyLeifer-skills",o.cognitoUserPoolId="eu-west-1_PsmNFdo3z",o.cognitoUserPoolRegion="eu-west-1",o.cognitoUserPoolAppClientName="guyLeifer-skills-app-client"},161:function(e,o,r){var t=this&&this.__awaiter||function(e,o,r,t){return new(r||(r=Promise))((function(i,n){function s(e){try{c(t.next(e))}catch(e){n(e)}}function l(e){try{c(t.throw(e))}catch(e){n(e)}}function c(e){var o;e.done?i(e.value):(o=e.value,o instanceof r?o:new r((function(e){e(o)}))).then(s,l)}c((t=t.apply(e,o||[])).next())}))};Object.defineProperty(o,"__esModule",{value:!0}),o.handler=void 0;const i=r(743),n=r(827),s=r(199);o.handler=e=>t(void 0,void 0,void 0,(function*(){var o,r,t;try{const{valid:c,message:a}=(0,s.validateRequest)(e,l);if(!c)throw new Error(a);const d=JSON.parse(e.body),{username:u,password:v}=d,P={AuthFlow:process.env.AUTH_FLOW_TYPE||"",ClientId:process.env.APP_CLIENT_ID||"",AuthParameters:{USERNAME:u,PASSWORD:v}},g=yield i.cognitoIdentityServiceProvider.initiateAuth(P).promise();return(0,n.createResponse)(200,{accessToken:null===(o=g.AuthenticationResult)||void 0===o?void 0:o.AccessToken,idToken:null===(r=g.AuthenticationResult)||void 0===r?void 0:r.IdToken,refreshToken:null===(t=g.AuthenticationResult)||void 0===t?void 0:t.RefreshToken})}catch(e){return(0,n.createResponse)(500,{error:e.message})}}));const l={username:e=>(0,s.validateIsraeliID)(e),password:e=>(0,s.validateStringMaxLength)(e,20)}},199:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.validateIsraeliID=o.validateIsraeliPhoneNumber=o.validateStringMinLength=o.validateStringMaxLength=o.validateRequest=void 0,o.validateRequest=(e,o)=>{if(!e.body)return{valid:!1,message:"Not valid request body"};const r=JSON.parse(e.body);for(const e in r){const t=r[e],i=o[e];if(i&&!i(t))return{valid:!1,message:`Not valid ${e} - ${t}`}}return{valid:!0}},o.validateStringMaxLength=(e,o)=>e.length<o,o.validateStringMinLength=(e,o)=>e.length>o,o.validateIsraeliPhoneNumber=e=>/^(05)[0-9]{8}$/.test(e),o.validateIsraeliID=e=>!((e=String(e).trim()).length>9)&&(e=e.length<9?("00000000"+e).slice(-9):e,Array.from(e,Number).reduce(((e,o,r)=>{const t=o*(r%2+1);return e+(t>9?t-9:t)}))%10==0)},336:e=>{e.exports=require("aws-sdk")}},o={},r=function r(t){var i=o[t];if(void 0!==i)return i.exports;var n=o[t]={exports:{}};return e[t].call(n.exports,n,n.exports,r),n.exports}(161),t=exports;for(var i in r)t[i]=r[i];r.__esModule&&Object.defineProperty(t,"__esModule",{value:!0})})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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c291cmNlcyI6WyJ3ZWJwYWNrOi8vZmludGVrYS8uL2F3cy1jb25maWcvYXBpR2V0d2F5LnRzIiwid2VicGFjazovL2ZpbnRla2EvLi9hd3MtY29uZmlnL2NvZ25pdG8udHMiLCJ3ZWJwYWNrOi8vZmludGVrYS8uL2F3cy1jb25maWcvY29uc3RhbnRzLnRzIiwid2VicGFjazovL2ZpbnRla2EvLi91c2VyTG9naW4vaW5kZXgudHMiLCJ3ZWJwYWNrOi8vZmludGVrYS8uL3V0aWxzL3ZhbGlkYXRpb25zLnRzIiwid2VicGFjazovL2ZpbnRla2EvZXh0ZXJuYWwgY29tbW9uanMgXCJhd3Mtc2RrXCIiLCJ3ZWJwYWNrOi8vZmludGVrYS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9maW50ZWthL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuY3JlYXRlUmVzcG9uc2UgPSB2b2lkIDA7XG5jb25zdCBjcmVhdGVSZXNwb25zZSA9IChzdGF0dXNDb2RlLCBib2R5KSA9PiAoe1xuICAgIHN0YXR1c0NvZGUsXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXG59KTtcbmV4cG9ydHMuY3JlYXRlUmVzcG9uc2UgPSBjcmVhdGVSZXNwb25zZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmNyZWF0ZVVzZXJQb29sQW5kQXBwQ2xpZW50ID0gZXhwb3J0cy5jb2duaXRvSWRlbnRpdHlTZXJ2aWNlUHJvdmlkZXIgPSB2b2lkIDA7XG5jb25zdCBhd3Nfc2RrXzEgPSByZXF1aXJlKFwiYXdzLXNka1wiKTtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4vY29uc3RhbnRzXCIpO1xuZXhwb3J0cy5jb2duaXRvSWRlbnRpdHlTZXJ2aWNlUHJvdmlkZXIgPSBuZXcgYXdzX3Nka18xLkNvZ25pdG9JZGVudGl0eVNlcnZpY2VQcm92aWRlcih7XG4gICAgcmVnaW9uOiBjb25zdGFudHNfMS5jb2duaXRvVXNlclBvb2xSZWdpb24sXG4gICAgYXBpVmVyc2lvbjogXCIyMDE2LTA0LTE4XCIsXG59KTtcbmNvbnN0IGNoZWNrSWZVc2VyUG9sbEV4aXN0cyA9IChjb2duaXRvVXNlclBvb2xOYW1lKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB2YXIgX2E7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbGlzdFVzZXJQb29sc1Jlc3BvbnNlID0geWllbGQgZXhwb3J0cy5jb2duaXRvSWRlbnRpdHlTZXJ2aWNlUHJvdmlkZXJcbiAgICAgICAgICAgIC5saXN0VXNlclBvb2xzKHsgTWF4UmVzdWx0czogMTAgfSlcbiAgICAgICAgICAgIC5wcm9taXNlKCk7XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nVXNlclBvb2wgPSAoX2EgPSBsaXN0VXNlclBvb2xzUmVzcG9uc2UuVXNlclBvb2xzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmluZCgocG9vbCkgPT4gcG9vbC5OYW1lID09PSBjb2duaXRvVXNlclBvb2xOYW1lKTtcbiAgICAgICAgaWYgKCFleGlzdGluZ1VzZXJQb29sKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVc2VyIFBvb2wgJHtjb2duaXRvVXNlclBvb2xOYW1lfSB3YXNuJ3QgZm91bmRgKTtcbiAgICAgICAgcmV0dXJuIGV4aXN0aW5nVXNlclBvb2wuSWQ7XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY2hlY2tpbmcgZm9yIGV4aXN0aW5nIFVzZXIgUG9vbDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxufSk7XG5jb25zdCBjcmVhdGVVc2VyUG9vbCA9IChQb29sTmFtZSwgVXNlcm5hbWVBdHRyaWJ1dGVzKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB2YXIgX2I7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlclBvb2xQYXJhbXMgPSBPYmplY3QuYXNzaWduKHsgUG9vbE5hbWUsIFBvbGljaWVzOiB7XG4gICAgICAgICAgICAgICAgUGFzc3dvcmRQb2xpY3k6IHtcbiAgICAgICAgICAgICAgICAgICAgTWluaW11bUxlbmd0aDogOCxcbiAgICAgICAgICAgICAgICAgICAgUmVxdWlyZVVwcGVyY2FzZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgUmVxdWlyZUxvd2VyY2FzZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgUmVxdWlyZU51bWJlcnM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIFJlcXVpcmVTeW1ib2xzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSB9LCAoVXNlcm5hbWVBdHRyaWJ1dGVzICYmIHsgVXNlcm5hbWVBdHRyaWJ1dGVzIH0pKTtcbiAgICAgICAgY29uc3QgdXNlclBvb2xSZXNwb25zZSA9IHlpZWxkIGV4cG9ydHMuY29nbml0b0lkZW50aXR5U2VydmljZVByb3ZpZGVyXG4gICAgICAgICAgICAuY3JlYXRlVXNlclBvb2wodXNlclBvb2xQYXJhbXMpXG4gICAgICAgICAgICAucHJvbWlzZSgpO1xuICAgICAgICBjb25zdCB1c2VyUG9vbElkID0gKF9iID0gdXNlclBvb2xSZXNwb25zZS5Vc2VyUG9vbCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLklkO1xuICAgICAgICByZXR1cm4gdXNlclBvb2xJZDtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjaGVja2luZyBmb3IgZXhpc3RpbmcgVXNlciBQb29sOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG59KTtcbmNvbnN0IGNoZWNrSWZVc2VyUG9sbEFwcENsaWVudEV4aXN0cyA9ICh1c2VyUG9vbElkLCBhcHBDbGllbnROYW1lKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB2YXIgX2M7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbGlzdFVzZXJQb29sQ2xpZW50c1Jlc3BvbnNlID0geWllbGQgZXhwb3J0cy5jb2duaXRvSWRlbnRpdHlTZXJ2aWNlUHJvdmlkZXJcbiAgICAgICAgICAgIC5saXN0VXNlclBvb2xDbGllbnRzKHsgVXNlclBvb2xJZDogdXNlclBvb2xJZCB9KVxuICAgICAgICAgICAgLnByb21pc2UoKTtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdBcHBDbGllbnQgPSAoX2MgPSBsaXN0VXNlclBvb2xDbGllbnRzUmVzcG9uc2UuVXNlclBvb2xDbGllbnRzKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZmluZCgoY2xpZW50KSA9PiBjbGllbnQuQ2xpZW50TmFtZSA9PT0gYXBwQ2xpZW50TmFtZSk7XG4gICAgICAgIGlmIChleGlzdGluZ0FwcENsaWVudClcbiAgICAgICAgICAgIHJldHVybiBleGlzdGluZ0FwcENsaWVudC5DbGllbnRJZDtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjaGVja2luZyBmb3IgZXhpc3RpbmcgVXNlciBQb29sOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG59KTtcbmNvbnN0IGNyZWF0ZVVzZXJQb29sQXBwQ2xpZW50ID0gKHVzZXJQb29sSWQpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHZhciBfZDtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhcHBDbGllbnRQYXJhbXMgPSB7XG4gICAgICAgICAgICBVc2VyUG9vbElkOiB1c2VyUG9vbElkLFxuICAgICAgICAgICAgQ2xpZW50TmFtZTogY29uc3RhbnRzXzEuY29nbml0b1VzZXJQb29sQXBwQ2xpZW50TmFtZSxcbiAgICAgICAgICAgIEdlbmVyYXRlU2VjcmV0OiBmYWxzZSxcbiAgICAgICAgICAgIEFsbG93ZWRPQXV0aEZsb3dzVXNlclBvb2xDbGllbnQ6IHRydWUsXG4gICAgICAgICAgICBBbGxvd2VkT0F1dGhGbG93czogW1wiY29kZVwiLCBcImltcGxpY2l0XCJdLFxuICAgICAgICAgICAgQWxsb3dlZE9BdXRoU2NvcGVzOiBbXCJwaG9uZVwiLCBcImVtYWlsXCIsIFwib3BlbmlkXCIsIFwicHJvZmlsZVwiXSxcbiAgICAgICAgICAgIEV4cGxpY2l0QXV0aEZsb3dzOiBbXG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5lbnYuQVVUSF9GTE9XX1RZUEUgfHwgXCJBTExPV19VU0VSX1BBU1NXT1JEX0FVVEhcIixcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBDYWxsYmFja1VSTHM6IFtcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9jYWxsYmFja1wiXSxcbiAgICAgICAgICAgIExvZ291dFVSTHM6IFtcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9sb2dvdXRcIl0sIC8vIFJlcGxhY2Ugd2l0aCB5b3VyIGxvZ291dCBVUkxzXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGFwcENsaWVudFJlc3BvbnNlID0geWllbGQgZXhwb3J0cy5jb2duaXRvSWRlbnRpdHlTZXJ2aWNlUHJvdmlkZXJcbiAgICAgICAgICAgIC5jcmVhdGVVc2VyUG9vbENsaWVudChhcHBDbGllbnRQYXJhbXMpXG4gICAgICAgICAgICAucHJvbWlzZSgpO1xuICAgICAgICBjb25zdCBhcHBDbGllbnRJZCA9IChfZCA9IGFwcENsaWVudFJlc3BvbnNlLlVzZXJQb29sQ2xpZW50KSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QuQ2xpZW50SWQ7XG4gICAgICAgIHJldHVybiBhcHBDbGllbnRJZDtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjaGVja2luZyBmb3IgZXhpc3RpbmcgVXNlciBQb29sOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG59KTtcbmNvbnN0IGNyZWF0ZVVzZXJQb29sQW5kQXBwQ2xpZW50ID0gKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgYXdzX3Nka18xLmNvbmZpZy51cGRhdGUoeyByZWdpb246IGNvbnN0YW50c18xLmNvZ25pdG9Vc2VyUG9vbFJlZ2lvbiB9KTtcbiAgICAgICAgY29uc3QgdXNlclBvb2xJZCA9ICh5aWVsZCBjaGVja0lmVXNlclBvbGxFeGlzdHMoY29uc3RhbnRzXzEuY29nbml0b1VzZXJQb29sTmFtZSkpIHx8XG4gICAgICAgICAgICAoeWllbGQgY3JlYXRlVXNlclBvb2woY29uc3RhbnRzXzEuY29nbml0b1VzZXJQb29sTmFtZSkpO1xuICAgICAgICBpZiAoIXVzZXJQb29sSWQpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVzZXIgUG9vbCAke2NvbnN0YW50c18xLmNvZ25pdG9Vc2VyUG9vbE5hbWV9IGRpZCBub3QgZm91bmQgb3IgY3JlYXRlZGApO1xuICAgICAgICBjb25zdCBhcHBDbGllbnRJZCA9ICh5aWVsZCBjaGVja0lmVXNlclBvbGxBcHBDbGllbnRFeGlzdHModXNlclBvb2xJZCwgY29uc3RhbnRzXzEuY29nbml0b1VzZXJQb29sQXBwQ2xpZW50TmFtZSkpIHx8ICh5aWVsZCBjcmVhdGVVc2VyUG9vbEFwcENsaWVudCh1c2VyUG9vbElkKSk7XG4gICAgICAgIHJldHVybiB7IHVzZXJQb29sSWQsIGFwcENsaWVudElkIH07XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY3JlYXRpbmcgVXNlciBQb29sOlwiLCBlcnJvcik7XG4gICAgfVxufSk7XG5leHBvcnRzLmNyZWF0ZVVzZXJQb29sQW5kQXBwQ2xpZW50ID0gY3JlYXRlVXNlclBvb2xBbmRBcHBDbGllbnQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuY29nbml0b1VzZXJQb29sQXBwQ2xpZW50TmFtZSA9IGV4cG9ydHMuY29nbml0b1VzZXJQb29sUmVnaW9uID0gZXhwb3J0cy5jb2duaXRvVXNlclBvb2xJZCA9IGV4cG9ydHMuY29nbml0b1VzZXJQb29sTmFtZSA9IHZvaWQgMDtcbmV4cG9ydHMuY29nbml0b1VzZXJQb29sTmFtZSA9IFwiZ3V5TGVpZmVyLXNraWxsc1wiO1xuZXhwb3J0cy5jb2duaXRvVXNlclBvb2xJZCA9IFwiZXUtd2VzdC0xX1BzbU5GZG8zelwiO1xuZXhwb3J0cy5jb2duaXRvVXNlclBvb2xSZWdpb24gPSBcImV1LXdlc3QtMVwiO1xuZXhwb3J0cy5jb2duaXRvVXNlclBvb2xBcHBDbGllbnROYW1lID0gXCJndXlMZWlmZXItc2tpbGxzLWFwcC1jbGllbnRcIjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmhhbmRsZXIgPSB2b2lkIDA7XG5jb25zdCBjb2duaXRvXzEgPSByZXF1aXJlKFwiLi4vYXdzLWNvbmZpZy9jb2duaXRvXCIpO1xuY29uc3QgYXBpR2V0d2F5XzEgPSByZXF1aXJlKFwiLi4vYXdzLWNvbmZpZy9hcGlHZXR3YXlcIik7XG5jb25zdCB2YWxpZGF0aW9uc18xID0gcmVxdWlyZShcIi4uL3V0aWxzL3ZhbGlkYXRpb25zXCIpO1xuY29uc3QgaGFuZGxlciA9IChldmVudCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyB2YWxpZCwgbWVzc2FnZSB9ID0gKDAsIHZhbGlkYXRpb25zXzEudmFsaWRhdGVSZXF1ZXN0KShldmVudCwgdmFsaWRhdGlvbnMpO1xuICAgICAgICBpZiAoIXZhbGlkKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xuICAgICAgICBjb25zdCByZXF1ZXN0Qm9keSA9IEpTT04ucGFyc2UoZXZlbnQuYm9keSk7XG4gICAgICAgIGNvbnN0IHsgdXNlcm5hbWUsIHBhc3N3b3JkIH0gPSByZXF1ZXN0Qm9keTtcbiAgICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICAgICAgQXV0aEZsb3c6IHByb2Nlc3MuZW52LkFVVEhfRkxPV19UWVBFIHx8IFwiXCIsXG4gICAgICAgICAgICBDbGllbnRJZDogcHJvY2Vzcy5lbnYuQVBQX0NMSUVOVF9JRCB8fCBcIlwiLFxuICAgICAgICAgICAgQXV0aFBhcmFtZXRlcnM6IHtcbiAgICAgICAgICAgICAgICBVU0VSTkFNRTogdXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgUEFTU1dPUkQ6IHBhc3N3b3JkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBjb2duaXRvXzEuY29nbml0b0lkZW50aXR5U2VydmljZVByb3ZpZGVyXG4gICAgICAgICAgICAuaW5pdGlhdGVBdXRoKHBhcmFtcylcbiAgICAgICAgICAgIC5wcm9taXNlKCk7XG4gICAgICAgIHJldHVybiAoMCwgYXBpR2V0d2F5XzEuY3JlYXRlUmVzcG9uc2UpKDIwMCwge1xuICAgICAgICAgICAgYWNjZXNzVG9rZW46IChfYSA9IHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuQWNjZXNzVG9rZW4sXG4gICAgICAgICAgICBpZFRva2VuOiAoX2IgPSByZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLklkVG9rZW4sXG4gICAgICAgICAgICByZWZyZXNoVG9rZW46IChfYyA9IHJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuUmVmcmVzaFRva2VuLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiAoMCwgYXBpR2V0d2F5XzEuY3JlYXRlUmVzcG9uc2UpKDUwMCwgeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcbiAgICB9XG59KTtcbmV4cG9ydHMuaGFuZGxlciA9IGhhbmRsZXI7XG5jb25zdCB2YWxpZGF0aW9ucyA9IHtcbiAgICB1c2VybmFtZTogKHZhbHVlKSA9PiAoMCwgdmFsaWRhdGlvbnNfMS52YWxpZGF0ZUlzcmFlbGlJRCkodmFsdWUpLFxuICAgIHBhc3N3b3JkOiAodmFsdWUpID0+ICgwLCB2YWxpZGF0aW9uc18xLnZhbGlkYXRlU3RyaW5nTWF4TGVuZ3RoKSh2YWx1ZSwgMjApLFxufTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy52YWxpZGF0ZUlzcmFlbGlJRCA9IGV4cG9ydHMudmFsaWRhdGVJc3JhZWxpUGhvbmVOdW1iZXIgPSBleHBvcnRzLnZhbGlkYXRlU3RyaW5nTWluTGVuZ3RoID0gZXhwb3J0cy52YWxpZGF0ZVN0cmluZ01heExlbmd0aCA9IGV4cG9ydHMudmFsaWRhdGVSZXF1ZXN0ID0gdm9pZCAwO1xuY29uc3QgdmFsaWRhdGVSZXF1ZXN0ID0gKGV2ZW50LCB2YWxpZGF0aW9ucykgPT4ge1xuICAgIGlmICghZXZlbnQuYm9keSlcbiAgICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBtZXNzYWdlOiBcIk5vdCB2YWxpZCByZXF1ZXN0IGJvZHlcIiB9O1xuICAgIGNvbnN0IHJlcXVlc3RCb2R5ID0gSlNPTi5wYXJzZShldmVudC5ib2R5KTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiByZXF1ZXN0Qm9keSkge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHJlcXVlc3RCb2R5W2tleV07XG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb25GdW5jdGlvbiA9IHZhbGlkYXRpb25zW2tleV07XG4gICAgICAgIGlmICh2YWxpZGF0aW9uRnVuY3Rpb24gJiYgIXZhbGlkYXRpb25GdW5jdGlvbih2YWx1ZSkpXG4gICAgICAgICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIG1lc3NhZ2U6IGBOb3QgdmFsaWQgJHtrZXl9IC0gJHt2YWx1ZX1gIH07XG4gICAgfVxuICAgIHJldHVybiB7IHZhbGlkOiB0cnVlIH07XG59O1xuZXhwb3J0cy52YWxpZGF0ZVJlcXVlc3QgPSB2YWxpZGF0ZVJlcXVlc3Q7XG5jb25zdCB2YWxpZGF0ZVN0cmluZ01heExlbmd0aCA9ICh2YWx1ZSwgbGVuZ3RoKSA9PiB2YWx1ZS5sZW5ndGggPCBsZW5ndGg7XG5leHBvcnRzLnZhbGlkYXRlU3RyaW5nTWF4TGVuZ3RoID0gdmFsaWRhdGVTdHJpbmdNYXhMZW5ndGg7XG5jb25zdCB2YWxpZGF0ZVN0cmluZ01pbkxlbmd0aCA9ICh2YWx1ZSwgbGVuZ3RoKSA9PiB2YWx1ZS5sZW5ndGggPiBsZW5ndGg7XG5leHBvcnRzLnZhbGlkYXRlU3RyaW5nTWluTGVuZ3RoID0gdmFsaWRhdGVTdHJpbmdNaW5MZW5ndGg7XG5jb25zdCB2YWxpZGF0ZUlzcmFlbGlQaG9uZU51bWJlciA9IChwaG9uZU51bWJlcikgPT4ge1xuICAgIGNvbnN0IHBob25lUmVnZXggPSAvXigwNSlbMC05XXs4fSQvO1xuICAgIHJldHVybiBwaG9uZVJlZ2V4LnRlc3QocGhvbmVOdW1iZXIpO1xufTtcbmV4cG9ydHMudmFsaWRhdGVJc3JhZWxpUGhvbmVOdW1iZXIgPSB2YWxpZGF0ZUlzcmFlbGlQaG9uZU51bWJlcjtcbmNvbnN0IHZhbGlkYXRlSXNyYWVsaUlEID0gKGlkKSA9PiB7XG4gICAgaWQgPSBTdHJpbmcoaWQpLnRyaW0oKTtcbiAgICBpZiAoaWQubGVuZ3RoID4gOSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlkID0gaWQubGVuZ3RoIDwgOSA/IChcIjAwMDAwMDAwXCIgKyBpZCkuc2xpY2UoLTkpIDogaWQ7XG4gICAgcmV0dXJuIChBcnJheS5mcm9tKGlkLCBOdW1iZXIpLnJlZHVjZSgoY291bnRlciwgZGlnaXQsIGkpID0+IHtcbiAgICAgICAgY29uc3Qgc3RlcCA9IGRpZ2l0ICogKChpICUgMikgKyAxKTtcbiAgICAgICAgcmV0dXJuIGNvdW50ZXIgKyAoc3RlcCA+IDkgPyBzdGVwIC0gOSA6IHN0ZXApO1xuICAgIH0pICVcbiAgICAgICAgMTAgPT09XG4gICAgICAgIDApO1xufTtcbmV4cG9ydHMudmFsaWRhdGVJc3JhZWxpSUQgPSB2YWxpZGF0ZUlzcmFlbGlJRDtcbiIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImF3cy1zZGtcIik7IiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNjEpO1xuIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiY3JlYXRlUmVzcG9uc2UiLCJzdGF0dXNDb2RlIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJfX2F3YWl0ZXIiLCJ0aGlzIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJjcmVhdGVVc2VyUG9vbEFuZEFwcENsaWVudCIsImNvZ25pdG9JZGVudGl0eVNlcnZpY2VQcm92aWRlciIsImF3c19zZGtfMSIsImNvbnN0YW50c18xIiwiQ29nbml0b0lkZW50aXR5U2VydmljZVByb3ZpZGVyIiwicmVnaW9uIiwiY29nbml0b1VzZXJQb29sUmVnaW9uIiwiYXBpVmVyc2lvbiIsImNvbmZpZyIsInVwZGF0ZSIsInVzZXJQb29sSWQiLCJjb2duaXRvVXNlclBvb2xOYW1lIiwiX2EiLCJleGlzdGluZ1VzZXJQb29sIiwibGlzdFVzZXJQb29scyIsIk1heFJlc3VsdHMiLCJwcm9taXNlIiwiVXNlclBvb2xzIiwiZmluZCIsInBvb2wiLCJOYW1lIiwiRXJyb3IiLCJJZCIsImVycm9yIiwiY29uc29sZSIsIlBvb2xOYW1lIiwiX2IiLCJ1c2VyUG9vbFBhcmFtcyIsImFzc2lnbiIsIlBvbGljaWVzIiwiUGFzc3dvcmRQb2xpY3kiLCJNaW5pbXVtTGVuZ3RoIiwiUmVxdWlyZVVwcGVyY2FzZSIsIlJlcXVpcmVMb3dlcmNhc2UiLCJSZXF1aXJlTnVtYmVycyIsIlJlcXVpcmVTeW1ib2xzIiwiVXNlcm5hbWVBdHRyaWJ1dGVzIiwiY3JlYXRlVXNlclBvb2wiLCJVc2VyUG9vbCIsImFwcENsaWVudElkIiwiYXBwQ2xpZW50TmFtZSIsIl9jIiwiZXhpc3RpbmdBcHBDbGllbnQiLCJsaXN0VXNlclBvb2xDbGllbnRzIiwiVXNlclBvb2xJZCIsIlVzZXJQb29sQ2xpZW50cyIsImNsaWVudCIsIkNsaWVudE5hbWUiLCJDbGllbnRJZCIsImNoZWNrSWZVc2VyUG9sbEFwcENsaWVudEV4aXN0cyIsImNvZ25pdG9Vc2VyUG9vbEFwcENsaWVudE5hbWUiLCJfZCIsImFwcENsaWVudFBhcmFtcyIsIkdlbmVyYXRlU2VjcmV0IiwiQWxsb3dlZE9BdXRoRmxvd3NVc2VyUG9vbENsaWVudCIsIkFsbG93ZWRPQXV0aEZsb3dzIiwiQWxsb3dlZE9BdXRoU2NvcGVzIiwiRXhwbGljaXRBdXRoRmxvd3MiLCJwcm9jZXNzIiwiZW52IiwiQVVUSF9GTE9XX1RZUEUiLCJDYWxsYmFja1VSTHMiLCJMb2dvdXRVUkxzIiwiY3JlYXRlVXNlclBvb2xDbGllbnQiLCJVc2VyUG9vbENsaWVudCIsImNyZWF0ZVVzZXJQb29sQXBwQ2xpZW50IiwiY29nbml0b1VzZXJQb29sSWQiLCJoYW5kbGVyIiwiY29nbml0b18xIiwiYXBpR2V0d2F5XzEiLCJ2YWxpZGF0aW9uc18xIiwiZXZlbnQiLCJ2YWxpZCIsIm1lc3NhZ2UiLCJ2YWxpZGF0ZVJlcXVlc3QiLCJ2YWxpZGF0aW9ucyIsInJlcXVlc3RCb2R5IiwicGFyc2UiLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwicGFyYW1zIiwiQXV0aEZsb3ciLCJBUFBfQ0xJRU5UX0lEIiwiQXV0aFBhcmFtZXRlcnMiLCJVU0VSTkFNRSIsIlBBU1NXT1JEIiwicmVzcG9uc2UiLCJpbml0aWF0ZUF1dGgiLCJhY2Nlc3NUb2tlbiIsIkF1dGhlbnRpY2F0aW9uUmVzdWx0IiwiQWNjZXNzVG9rZW4iLCJpZFRva2VuIiwiSWRUb2tlbiIsInJlZnJlc2hUb2tlbiIsIlJlZnJlc2hUb2tlbiIsInZhbGlkYXRlSXNyYWVsaUlEIiwidmFsaWRhdGVTdHJpbmdNYXhMZW5ndGgiLCJ2YWxpZGF0ZUlzcmFlbGlQaG9uZU51bWJlciIsInZhbGlkYXRlU3RyaW5nTWluTGVuZ3RoIiwia2V5IiwidmFsaWRhdGlvbkZ1bmN0aW9uIiwibGVuZ3RoIiwicGhvbmVOdW1iZXIiLCJ0ZXN0IiwiaWQiLCJTdHJpbmciLCJ0cmltIiwic2xpY2UiLCJBcnJheSIsImZyb20iLCJOdW1iZXIiLCJyZWR1Y2UiLCJjb3VudGVyIiwiZGlnaXQiLCJpIiwibW9kdWxlIiwicmVxdWlyZSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19leHBvcnRzX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCJdLCJzb3VyY2VSb290IjoiIn0=