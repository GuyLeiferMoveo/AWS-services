(()=>{"use strict";var e={827:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createResponse=void 0,o.createResponse=(e,o)=>({statusCode:e,body:JSON.stringify(o)})},743:function(e,o,t){var r=this&&this.__awaiter||function(e,o,t,r){return new(t||(t=Promise))((function(i,n){function s(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var o;e.done?i(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(s,a)}l((r=r.apply(e,o||[])).next())}))};Object.defineProperty(o,"__esModule",{value:!0}),o.createUserPoolAndAppClient=o.cognitoIdentityServiceProvider=void 0;const i=t(336),n=t(259);o.cognitoIdentityServiceProvider=new i.CognitoIdentityServiceProvider({region:n.cognitoUserPoolRegion,apiVersion:"2016-04-18"}),o.createUserPoolAndAppClient=()=>r(void 0,void 0,void 0,(function*(){try{i.config.update({region:n.cognitoUserPoolRegion});const a=(yield(s=n.cognitoUserPoolName,r(void 0,void 0,void 0,(function*(){var e;try{const t=null===(e=(yield o.cognitoIdentityServiceProvider.listUserPools({MaxResults:10}).promise()).UserPools)||void 0===e?void 0:e.find((e=>e.Name===s));if(!t)throw new Error(`User Pool ${s} wasn't found`);return t.Id}catch(e){return void console.error("Error checking for existing User Pool:",e)}}))))||(yield(e=n.cognitoUserPoolName,r(void 0,void 0,void 0,(function*(){var r;try{const i=Object.assign({PoolName:e,Policies:{PasswordPolicy:{MinimumLength:8,RequireUppercase:!0,RequireLowercase:!0,RequireNumbers:!0,RequireSymbols:!1}}},t);return null===(r=(yield o.cognitoIdentityServiceProvider.createUserPool(i).promise()).UserPool)||void 0===r?void 0:r.Id}catch(e){return void console.error("Error checking for existing User Pool:",e)}}))));if(!a)throw new Error(`User Pool ${n.cognitoUserPoolName} did not found or created`);const l=(yield((e,t)=>r(void 0,void 0,void 0,(function*(){var r;try{const i=null===(r=(yield o.cognitoIdentityServiceProvider.listUserPoolClients({UserPoolId:e}).promise()).UserPoolClients)||void 0===r?void 0:r.find((e=>e.ClientName===t));if(i)return i.ClientId}catch(e){return void console.error("Error checking for existing User Pool:",e)}})))(a,n.cognitoUserPoolAppClientName))||(yield(e=>r(void 0,void 0,void 0,(function*(){var t;try{const r={UserPoolId:e,ClientName:n.cognitoUserPoolAppClientName,GenerateSecret:!1,AllowedOAuthFlowsUserPoolClient:!0,AllowedOAuthFlows:["code","implicit"],AllowedOAuthScopes:["phone","email","openid","profile"],ExplicitAuthFlows:[process.env.AUTH_FLOW_TYPE||"ALLOW_USER_PASSWORD_AUTH"],CallbackURLs:["http://localhost:3000/callback"],LogoutURLs:["http://localhost:3000/logout"]};return null===(t=(yield o.cognitoIdentityServiceProvider.createUserPoolClient(r).promise()).UserPoolClient)||void 0===t?void 0:t.ClientId}catch(e){return void console.error("Error checking for existing User Pool:",e)}})))(a));return{userPoolId:a,appClientId:l}}catch(e){console.error("Error creating User Pool:",e)}var e,t,s}))},259:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.cognitoUserPoolAppClientName=o.cognitoUserPoolRegion=o.cognitoUserPoolId=o.cognitoUserPoolName=void 0,o.cognitoUserPoolName="guyLeifer-skills",o.cognitoUserPoolId="eu-west-1_PsmNFdo3z",o.cognitoUserPoolRegion="eu-west-1",o.cognitoUserPoolAppClientName="guyLeifer-skills-app-client"},583:function(e,o,t){var r=this&&this.__awaiter||function(e,o,t,r){return new(t||(t=Promise))((function(i,n){function s(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var o;e.done?i(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(s,a)}l((r=r.apply(e,o||[])).next())}))};Object.defineProperty(o,"__esModule",{value:!0}),o.createTableIfNotExists=o.dynamoDb=void 0;const i=t(336);o.dynamoDb=new i.DynamoDB.DocumentClient({region:"il-central-1"});const n=new i.DynamoDB;o.createTableIfNotExists=()=>r(void 0,void 0,void 0,(function*(){var e;try{if(null===(e=(yield n.listTables().promise()).TableNames)||void 0===e?void 0:e.includes(process.env.DB_TABLE_NAME||"users"))return void console.log(`Table ${process.env.DB_TABLE_NAME} already exists.`);const o={TableName:process.env.DB_TABLE_NAME||"users",KeySchema:[{AttributeName:"userId",KeyType:"HASH"}],AttributeDefinitions:[{AttributeName:"userId",AttributeType:"S"}],ProvisionedThroughput:{ReadCapacityUnits:5,WriteCapacityUnits:5}},t=yield n.createTable(o).promise();return console.log(`Table ${process.env.DB_TABLE_NAME} created successfully.`),t}catch(e){console.error("Error creating table:",e)}}))},992:function(e,o,t){var r=this&&this.__awaiter||function(e,o,t,r){return new(t||(t=Promise))((function(i,n){function s(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var o;e.done?i(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(s,a)}l((r=r.apply(e,o||[])).next())}))};Object.defineProperty(o,"__esModule",{value:!0}),o.handler=void 0;const i=t(743),n=t(583),s=t(44),a=t(827),l=t(199),c={firstName:{cognito:"given_name",ddb:"firstName"},lastName:{cognito:"family_name",ddb:"lastName"},phoneNumber:{cognito:"phone_number",ddb:"phoneNumber"}};o.handler=e=>r(void 0,void 0,void 0,(function*(){var o;if(!(0,s.isUserAuthenticatedAuthorizer)(e))return s.unauthorizedResponse;try{const{valid:t,message:r}=(0,l.validateRequest)(e,d);if(!t)throw new Error(r);const s=e.body||"",u=JSON.parse(s),v=Object.assign({},u);delete v.userId;const p=[],h={};let f="SET ";Object.entries(v).forEach((([e,o],t)=>{p.push({Name:c[e].cognito,Value:o});const r=`:val${t}`;h[r]=o,f+=`${c[e].ddb} = ${r}, `})),f=f.slice(0,-2);const g={AccessToken:(null===(o=e.headers.Authorization)||void 0===o?void 0:o.split(" ")[1])||"",UserAttributes:p},y=(yield i.cognitoIdentityServiceProvider.updateUserAttributes(g).promise(),{TableName:process.env.DB_TABLE_NAME||"",Key:{userId:u.userId},UpdateExpression:f,ExpressionAttributeValues:h,ReturnValues:"ALL_NEW"}),m=yield n.dynamoDb.update(y).promise();return(0,a.createResponse)(200,m.Attributes||{})}catch(e){return(0,a.createResponse)(500,{error:e.message})}}));const d={firstName:e=>(0,l.validateStringMaxLength)(e,20),lastName:e=>(0,l.validateStringMaxLength)(e,20),password:e=>(0,l.validateStringMaxLength)(e,20),phoneNumber:e=>(0,l.validateIsraeliPhoneNumber)(e),userId:e=>(0,l.validateIsraeliID)(e)}},44:function(e,o,t){var r=this&&this.__awaiter||function(e,o,t,r){return new(t||(t=Promise))((function(i,n){function s(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var o;e.done?i(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(s,a)}l((r=r.apply(e,o||[])).next())}))};Object.defineProperty(o,"__esModule",{value:!0}),o.unauthorizedResponse=o.isUserAuthenticatedAuthorizer=o.isUserAuthenticated=void 0;const i=t(743);o.isUserAuthenticated=e=>r(void 0,void 0,void 0,(function*(){var o;const t=null===(o=e.headers.Authorization)||void 0===o?void 0:o.split(" ")[1];return!!t&&!!(yield i.cognitoIdentityServiceProvider.getUser({AccessToken:t}).promise())})),o.isUserAuthenticatedAuthorizer=e=>{const o=e.requestContext.authorizer;return!!o&&!!o.claims},o.unauthorizedResponse={statusCode:401,body:JSON.stringify({error:"Unauthorized"})}},199:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.validateIsraeliID=o.validateIsraeliPhoneNumber=o.validateStringMinLength=o.validateStringMaxLength=o.validateRequest=void 0,o.validateRequest=(e,o)=>{if(!e.body)return{valid:!1,message:"Not valid request body"};const t=JSON.parse(e.body);for(const e in t){const r=t[e],i=o[e];if(i&&!i(r))return{valid:!1,message:`Not valid ${e} - ${r}`}}return{valid:!0}},o.validateStringMaxLength=(e,o)=>e.length<o,o.validateStringMinLength=(e,o)=>e.length>o,o.validateIsraeliPhoneNumber=e=>/^(05)[0-9]{8}$/.test(e),o.validateIsraeliID=e=>!((e=String(e).trim()).length>9)&&(e=e.length<9?("00000000"+e).slice(-9):e,Array.from(e,Number).reduce(((e,o,t)=>{const r=o*(t%2+1);return e+(r>9?r-9:r)}))%10==0)},336:e=>{e.exports=require("aws-sdk")}},o={},t=function t(r){var i=o[r];if(void 0!==i)return i.exports;var n=o[r]={exports:{}};return e[r].call(n.exports,n,n.exports,t),n.exports}(992),r=exports;for(var i in t)r[i]=t[i];t.__esModule&&Object.defineProperty(r,"__esModule",{value:!0})})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cUJFLElBQWpCRCxFQUNILE9BQU9BLEVBQWE5TCxRQUdyQixJQUFJd0wsRUFBU0UsRUFBeUJHLEdBQVksQ0FHakQ3TCxRQUFTLENBQUMsR0FPWCxPQUhBZ00sRUFBb0JILEdBQVVJLEtBQUtULEVBQU94TCxRQUFTd0wsRUFBUUEsRUFBT3hMLFFBQVM0TCxHQUdwRUosRUFBT3hMLE9BQ2YsQ0NuQjBCNEwsQ0FBb0IsSyIsInNvdXJjZXMiOlsid2VicGFjazovL2ZpbnRla2EvLi9hd3MtY29uZmlnL2FwaUdldHdheS50cyIsIndlYnBhY2s6Ly9maW50ZWthLy4vYXdzLWNvbmZpZy9jb2duaXRvLnRzIiwid2VicGFjazovL2ZpbnRla2EvLi9hd3MtY29uZmlnL2NvbnN0YW50cy50cyIsIndlYnBhY2s6Ly9maW50ZWthLy4vYXdzLWNvbmZpZy9keW5hbW9EQi50cyIsIndlYnBhY2s6Ly9maW50ZWthLy4vdXBkYXRlVXNlci9pbmRleC50cyIsIndlYnBhY2s6Ly9maW50ZWthLy4vdXRpbHMvYXV0aG9yaXplci50cyIsIndlYnBhY2s6Ly9maW50ZWthLy4vdXRpbHMvdmFsaWRhdGlvbnMudHMiLCJ3ZWJwYWNrOi8vZmludGVrYS9leHRlcm5hbCBjb21tb25qcyBcImF3cy1zZGtcIiIsIndlYnBhY2s6Ly9maW50ZWthL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2ZpbnRla2Evd2VicGFjay9zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5jcmVhdGVSZXNwb25zZSA9IHZvaWQgMDtcbmNvbnN0IGNyZWF0ZVJlc3BvbnNlID0gKHN0YXR1c0NvZGUsIGJvZHkpID0+ICh7XG4gICAgc3RhdHVzQ29kZSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSxcbn0pO1xuZXhwb3J0cy5jcmVhdGVSZXNwb25zZSA9IGNyZWF0ZVJlc3BvbnNlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuY3JlYXRlVXNlclBvb2xBbmRBcHBDbGllbnQgPSBleHBvcnRzLmNvZ25pdG9JZGVudGl0eVNlcnZpY2VQcm92aWRlciA9IHZvaWQgMDtcbmNvbnN0IGF3c19zZGtfMSA9IHJlcXVpcmUoXCJhd3Mtc2RrXCIpO1xuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi9jb25zdGFudHNcIik7XG5leHBvcnRzLmNvZ25pdG9JZGVudGl0eVNlcnZpY2VQcm92aWRlciA9IG5ldyBhd3Nfc2RrXzEuQ29nbml0b0lkZW50aXR5U2VydmljZVByb3ZpZGVyKHtcbiAgICByZWdpb246IGNvbnN0YW50c18xLmNvZ25pdG9Vc2VyUG9vbFJlZ2lvbixcbiAgICBhcGlWZXJzaW9uOiBcIjIwMTYtMDQtMThcIixcbn0pO1xuY29uc3QgY2hlY2tJZlVzZXJQb2xsRXhpc3RzID0gKGNvZ25pdG9Vc2VyUG9vbE5hbWUpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHZhciBfYTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBsaXN0VXNlclBvb2xzUmVzcG9uc2UgPSB5aWVsZCBleHBvcnRzLmNvZ25pdG9JZGVudGl0eVNlcnZpY2VQcm92aWRlclxuICAgICAgICAgICAgLmxpc3RVc2VyUG9vbHMoeyBNYXhSZXN1bHRzOiAxMCB9KVxuICAgICAgICAgICAgLnByb21pc2UoKTtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdVc2VyUG9vbCA9IChfYSA9IGxpc3RVc2VyUG9vbHNSZXNwb25zZS5Vc2VyUG9vbHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5maW5kKChwb29sKSA9PiBwb29sLk5hbWUgPT09IGNvZ25pdG9Vc2VyUG9vbE5hbWUpO1xuICAgICAgICBpZiAoIWV4aXN0aW5nVXNlclBvb2wpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVzZXIgUG9vbCAke2NvZ25pdG9Vc2VyUG9vbE5hbWV9IHdhc24ndCBmb3VuZGApO1xuICAgICAgICByZXR1cm4gZXhpc3RpbmdVc2VyUG9vbC5JZDtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjaGVja2luZyBmb3IgZXhpc3RpbmcgVXNlciBQb29sOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG59KTtcbmNvbnN0IGNyZWF0ZVVzZXJQb29sID0gKFBvb2xOYW1lLCBVc2VybmFtZUF0dHJpYnV0ZXMpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHZhciBfYjtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VyUG9vbFBhcmFtcyA9IE9iamVjdC5hc3NpZ24oeyBQb29sTmFtZSwgUG9saWNpZXM6IHtcbiAgICAgICAgICAgICAgICBQYXNzd29yZFBvbGljeToge1xuICAgICAgICAgICAgICAgICAgICBNaW5pbXVtTGVuZ3RoOiA4LFxuICAgICAgICAgICAgICAgICAgICBSZXF1aXJlVXBwZXJjYXNlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBSZXF1aXJlTG93ZXJjYXNlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBSZXF1aXJlTnVtYmVyczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgUmVxdWlyZVN5bWJvbHM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9IH0sIChVc2VybmFtZUF0dHJpYnV0ZXMgJiYgeyBVc2VybmFtZUF0dHJpYnV0ZXMgfSkpO1xuICAgICAgICBjb25zdCB1c2VyUG9vbFJlc3BvbnNlID0geWllbGQgZXhwb3J0cy5jb2duaXRvSWRlbnRpdHlTZXJ2aWNlUHJvdmlkZXJcbiAgICAgICAgICAgIC5jcmVhdGVVc2VyUG9vbCh1c2VyUG9vbFBhcmFtcylcbiAgICAgICAgICAgIC5wcm9taXNlKCk7XG4gICAgICAgIGNvbnN0IHVzZXJQb29sSWQgPSAoX2IgPSB1c2VyUG9vbFJlc3BvbnNlLlVzZXJQb29sKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuSWQ7XG4gICAgICAgIHJldHVybiB1c2VyUG9vbElkO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNoZWNraW5nIGZvciBleGlzdGluZyBVc2VyIFBvb2w6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbn0pO1xuY29uc3QgY2hlY2tJZlVzZXJQb2xsQXBwQ2xpZW50RXhpc3RzID0gKHVzZXJQb29sSWQsIGFwcENsaWVudE5hbWUpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHZhciBfYztcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBsaXN0VXNlclBvb2xDbGllbnRzUmVzcG9uc2UgPSB5aWVsZCBleHBvcnRzLmNvZ25pdG9JZGVudGl0eVNlcnZpY2VQcm92aWRlclxuICAgICAgICAgICAgLmxpc3RVc2VyUG9vbENsaWVudHMoeyBVc2VyUG9vbElkOiB1c2VyUG9vbElkIH0pXG4gICAgICAgICAgICAucHJvbWlzZSgpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FwcENsaWVudCA9IChfYyA9IGxpc3RVc2VyUG9vbENsaWVudHNSZXNwb25zZS5Vc2VyUG9vbENsaWVudHMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5maW5kKChjbGllbnQpID0+IGNsaWVudC5DbGllbnROYW1lID09PSBhcHBDbGllbnROYW1lKTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQXBwQ2xpZW50KVxuICAgICAgICAgICAgcmV0dXJuIGV4aXN0aW5nQXBwQ2xpZW50LkNsaWVudElkO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNoZWNraW5nIGZvciBleGlzdGluZyBVc2VyIFBvb2w6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbn0pO1xuY29uc3QgY3JlYXRlVXNlclBvb2xBcHBDbGllbnQgPSAodXNlclBvb2xJZCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdmFyIF9kO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFwcENsaWVudFBhcmFtcyA9IHtcbiAgICAgICAgICAgIFVzZXJQb29sSWQ6IHVzZXJQb29sSWQsXG4gICAgICAgICAgICBDbGllbnROYW1lOiBjb25zdGFudHNfMS5jb2duaXRvVXNlclBvb2xBcHBDbGllbnROYW1lLFxuICAgICAgICAgICAgR2VuZXJhdGVTZWNyZXQ6IGZhbHNlLFxuICAgICAgICAgICAgQWxsb3dlZE9BdXRoRmxvd3NVc2VyUG9vbENsaWVudDogdHJ1ZSxcbiAgICAgICAgICAgIEFsbG93ZWRPQXV0aEZsb3dzOiBbXCJjb2RlXCIsIFwiaW1wbGljaXRcIl0sXG4gICAgICAgICAgICBBbGxvd2VkT0F1dGhTY29wZXM6IFtcInBob25lXCIsIFwiZW1haWxcIiwgXCJvcGVuaWRcIiwgXCJwcm9maWxlXCJdLFxuICAgICAgICAgICAgRXhwbGljaXRBdXRoRmxvd3M6IFtcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmVudi5BVVRIX0ZMT1dfVFlQRSB8fCBcIkFMTE9XX1VTRVJfUEFTU1dPUkRfQVVUSFwiLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIENhbGxiYWNrVVJMczogW1wiaHR0cDovL2xvY2FsaG9zdDozMDAwL2NhbGxiYWNrXCJdLFxuICAgICAgICAgICAgTG9nb3V0VVJMczogW1wiaHR0cDovL2xvY2FsaG9zdDozMDAwL2xvZ291dFwiXSwgLy8gUmVwbGFjZSB3aXRoIHlvdXIgbG9nb3V0IFVSTHNcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgYXBwQ2xpZW50UmVzcG9uc2UgPSB5aWVsZCBleHBvcnRzLmNvZ25pdG9JZGVudGl0eVNlcnZpY2VQcm92aWRlclxuICAgICAgICAgICAgLmNyZWF0ZVVzZXJQb29sQ2xpZW50KGFwcENsaWVudFBhcmFtcylcbiAgICAgICAgICAgIC5wcm9taXNlKCk7XG4gICAgICAgIGNvbnN0IGFwcENsaWVudElkID0gKF9kID0gYXBwQ2xpZW50UmVzcG9uc2UuVXNlclBvb2xDbGllbnQpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5DbGllbnRJZDtcbiAgICAgICAgcmV0dXJuIGFwcENsaWVudElkO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNoZWNraW5nIGZvciBleGlzdGluZyBVc2VyIFBvb2w6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbn0pO1xuY29uc3QgY3JlYXRlVXNlclBvb2xBbmRBcHBDbGllbnQgPSAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICB0cnkge1xuICAgICAgICBhd3Nfc2RrXzEuY29uZmlnLnVwZGF0ZSh7IHJlZ2lvbjogY29uc3RhbnRzXzEuY29nbml0b1VzZXJQb29sUmVnaW9uIH0pO1xuICAgICAgICBjb25zdCB1c2VyUG9vbElkID0gKHlpZWxkIGNoZWNrSWZVc2VyUG9sbEV4aXN0cyhjb25zdGFudHNfMS5jb2duaXRvVXNlclBvb2xOYW1lKSkgfHxcbiAgICAgICAgICAgICh5aWVsZCBjcmVhdGVVc2VyUG9vbChjb25zdGFudHNfMS5jb2duaXRvVXNlclBvb2xOYW1lKSk7XG4gICAgICAgIGlmICghdXNlclBvb2xJZClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVXNlciBQb29sICR7Y29uc3RhbnRzXzEuY29nbml0b1VzZXJQb29sTmFtZX0gZGlkIG5vdCBmb3VuZCBvciBjcmVhdGVkYCk7XG4gICAgICAgIGNvbnN0IGFwcENsaWVudElkID0gKHlpZWxkIGNoZWNrSWZVc2VyUG9sbEFwcENsaWVudEV4aXN0cyh1c2VyUG9vbElkLCBjb25zdGFudHNfMS5jb2duaXRvVXNlclBvb2xBcHBDbGllbnROYW1lKSkgfHwgKHlpZWxkIGNyZWF0ZVVzZXJQb29sQXBwQ2xpZW50KHVzZXJQb29sSWQpKTtcbiAgICAgICAgcmV0dXJuIHsgdXNlclBvb2xJZCwgYXBwQ2xpZW50SWQgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjcmVhdGluZyBVc2VyIFBvb2w6XCIsIGVycm9yKTtcbiAgICB9XG59KTtcbmV4cG9ydHMuY3JlYXRlVXNlclBvb2xBbmRBcHBDbGllbnQgPSBjcmVhdGVVc2VyUG9vbEFuZEFwcENsaWVudDtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5jb2duaXRvVXNlclBvb2xBcHBDbGllbnROYW1lID0gZXhwb3J0cy5jb2duaXRvVXNlclBvb2xSZWdpb24gPSBleHBvcnRzLmNvZ25pdG9Vc2VyUG9vbElkID0gZXhwb3J0cy5jb2duaXRvVXNlclBvb2xOYW1lID0gdm9pZCAwO1xuZXhwb3J0cy5jb2duaXRvVXNlclBvb2xOYW1lID0gXCJndXlMZWlmZXItc2tpbGxzXCI7XG5leHBvcnRzLmNvZ25pdG9Vc2VyUG9vbElkID0gXCJldS13ZXN0LTFfUHNtTkZkbzN6XCI7XG5leHBvcnRzLmNvZ25pdG9Vc2VyUG9vbFJlZ2lvbiA9IFwiZXUtd2VzdC0xXCI7XG5leHBvcnRzLmNvZ25pdG9Vc2VyUG9vbEFwcENsaWVudE5hbWUgPSBcImd1eUxlaWZlci1za2lsbHMtYXBwLWNsaWVudFwiO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuY3JlYXRlVGFibGVJZk5vdEV4aXN0cyA9IGV4cG9ydHMuZHluYW1vRGIgPSB2b2lkIDA7XG5jb25zdCBhd3Nfc2RrXzEgPSByZXF1aXJlKFwiYXdzLXNka1wiKTtcbmV4cG9ydHMuZHluYW1vRGIgPSBuZXcgYXdzX3Nka18xLkR5bmFtb0RCLkRvY3VtZW50Q2xpZW50KHsgcmVnaW9uOiBcImlsLWNlbnRyYWwtMVwiIH0pO1xuY29uc3QgZHluYW1vREJTZXJ2aWNlID0gbmV3IGF3c19zZGtfMS5EeW5hbW9EQigpOyAvLyBDcmVhdGUgYSBEeW5hbW9EQiBzZXJ2aWNlIGNsaWVudFxuY29uc3QgY3JlYXRlVGFibGVJZk5vdEV4aXN0cyA9ICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHZhciBfYTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBleGlzdGluZ1RhYmxlcyA9IHlpZWxkIGR5bmFtb0RCU2VydmljZS5saXN0VGFibGVzKCkucHJvbWlzZSgpO1xuICAgICAgICBpZiAoKF9hID0gZXhpc3RpbmdUYWJsZXMuVGFibGVOYW1lcykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmluY2x1ZGVzKHByb2Nlc3MuZW52LkRCX1RBQkxFX05BTUUgfHwgXCJ1c2Vyc1wiKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYFRhYmxlICR7cHJvY2Vzcy5lbnYuREJfVEFCTEVfTkFNRX0gYWxyZWFkeSBleGlzdHMuYCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICAgICAgVGFibGVOYW1lOiBwcm9jZXNzLmVudi5EQl9UQUJMRV9OQU1FIHx8IFwidXNlcnNcIixcbiAgICAgICAgICAgIEtleVNjaGVtYTogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgQXR0cmlidXRlTmFtZTogXCJ1c2VySWRcIixcbiAgICAgICAgICAgICAgICAgICAgS2V5VHlwZTogXCJIQVNIXCIsIC8vIFBhcnRpdGlvbiBrZXlcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIEF0dHJpYnV0ZURlZmluaXRpb25zOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBBdHRyaWJ1dGVOYW1lOiBcInVzZXJJZFwiLFxuICAgICAgICAgICAgICAgICAgICBBdHRyaWJ1dGVUeXBlOiBcIlNcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIFByb3Zpc2lvbmVkVGhyb3VnaHB1dDoge1xuICAgICAgICAgICAgICAgIFJlYWRDYXBhY2l0eVVuaXRzOiA1LFxuICAgICAgICAgICAgICAgIFdyaXRlQ2FwYWNpdHlVbml0czogNSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHRhYmxlID0geWllbGQgZHluYW1vREJTZXJ2aWNlLmNyZWF0ZVRhYmxlKHBhcmFtcykucHJvbWlzZSgpO1xuICAgICAgICBjb25zb2xlLmxvZyhgVGFibGUgJHtwcm9jZXNzLmVudi5EQl9UQUJMRV9OQU1FfSBjcmVhdGVkIHN1Y2Nlc3NmdWxseS5gKTtcbiAgICAgICAgcmV0dXJuIHRhYmxlO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNyZWF0aW5nIHRhYmxlOlwiLCBlcnJvcik7XG4gICAgfVxufSk7XG5leHBvcnRzLmNyZWF0ZVRhYmxlSWZOb3RFeGlzdHMgPSBjcmVhdGVUYWJsZUlmTm90RXhpc3RzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuaGFuZGxlciA9IHZvaWQgMDtcbmNvbnN0IGNvZ25pdG9fMSA9IHJlcXVpcmUoXCIuLi9hd3MtY29uZmlnL2NvZ25pdG9cIik7XG5jb25zdCBkeW5hbW9EQl8xID0gcmVxdWlyZShcIi4uL2F3cy1jb25maWcvZHluYW1vREJcIik7XG5jb25zdCBhdXRob3JpemVyXzEgPSByZXF1aXJlKFwiLi4vdXRpbHMvYXV0aG9yaXplclwiKTtcbmNvbnN0IGFwaUdldHdheV8xID0gcmVxdWlyZShcIi4uL2F3cy1jb25maWcvYXBpR2V0d2F5XCIpO1xuY29uc3QgdmFsaWRhdGlvbnNfMSA9IHJlcXVpcmUoXCIuLi91dGlscy92YWxpZGF0aW9uc1wiKTtcbmNvbnN0IGJvZHlJbmRleCA9IHtcbiAgICBmaXJzdE5hbWU6IHtcbiAgICAgICAgY29nbml0bzogXCJnaXZlbl9uYW1lXCIsXG4gICAgICAgIGRkYjogXCJmaXJzdE5hbWVcIixcbiAgICB9LFxuICAgIGxhc3ROYW1lOiB7XG4gICAgICAgIGNvZ25pdG86IFwiZmFtaWx5X25hbWVcIixcbiAgICAgICAgZGRiOiBcImxhc3ROYW1lXCIsXG4gICAgfSxcbiAgICBwaG9uZU51bWJlcjoge1xuICAgICAgICBjb2duaXRvOiBcInBob25lX251bWJlclwiLFxuICAgICAgICBkZGI6IFwicGhvbmVOdW1iZXJcIixcbiAgICB9LFxufTtcbmNvbnN0IGhhbmRsZXIgPSAoZXZlbnQpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHZhciBfYTtcbiAgICBpZiAoISgwLCBhdXRob3JpemVyXzEuaXNVc2VyQXV0aGVudGljYXRlZEF1dGhvcml6ZXIpKGV2ZW50KSlcbiAgICAgICAgcmV0dXJuIGF1dGhvcml6ZXJfMS51bmF1dGhvcml6ZWRSZXNwb25zZTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB7IHZhbGlkLCBtZXNzYWdlIH0gPSAoMCwgdmFsaWRhdGlvbnNfMS52YWxpZGF0ZVJlcXVlc3QpKGV2ZW50LCB2YWxpZGF0aW9ucyk7XG4gICAgICAgIGlmICghdmFsaWQpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7XG4gICAgICAgIGNvbnN0IHJlcXVlc3RCb2R5ID0gZXZlbnQuYm9keSB8fCBcIlwiO1xuICAgICAgICBjb25zdCByZXF1ZXN0Qm9keUpzb24gPSBKU09OLnBhcnNlKHJlcXVlc3RCb2R5KTtcbiAgICAgICAgY29uc3QgZGV0YWlsc1RvVXBkYXRlID0gT2JqZWN0LmFzc2lnbih7fSwgcmVxdWVzdEJvZHlKc29uKTtcbiAgICAgICAgZGVsZXRlIGRldGFpbHNUb1VwZGF0ZS51c2VySWQ7XG4gICAgICAgIGNvbnN0IFVzZXJBdHRyaWJ1dGVzID0gW107XG4gICAgICAgIGNvbnN0IGV4cHJlc3Npb25BdHRyaWJ1dGVWYWx1ZXMgPSB7fTtcbiAgICAgICAgbGV0IHVwZGF0ZUV4cHJlc3Npb24gPSBcIlNFVCBcIjtcbiAgICAgICAgT2JqZWN0LmVudHJpZXMoZGV0YWlsc1RvVXBkYXRlKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0sIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBVc2VyQXR0cmlidXRlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBOYW1lOiBib2R5SW5kZXhba2V5XS5jb2duaXRvLFxuICAgICAgICAgICAgICAgIFZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgdmFsID0gYDp2YWwke2luZGV4fWA7XG4gICAgICAgICAgICBleHByZXNzaW9uQXR0cmlidXRlVmFsdWVzW3ZhbF0gPSB2YWx1ZTtcbiAgICAgICAgICAgIHVwZGF0ZUV4cHJlc3Npb24gKz0gYCR7Ym9keUluZGV4W2tleV0uZGRifSA9ICR7dmFsfSwgYDtcbiAgICAgICAgfSk7XG4gICAgICAgIHVwZGF0ZUV4cHJlc3Npb24gPSB1cGRhdGVFeHByZXNzaW9uLnNsaWNlKDAsIC0yKTtcbiAgICAgICAgY29uc3QgdXBkYXRlUGFyYW1zID0ge1xuICAgICAgICAgICAgLy8gQWNjZXNzVG9rZW46IGV2ZW50LnJlcXVlc3RDb250ZXh0LmF1dGhvcml6ZXI/LmNsYWltcy5qdGksIC8vIFRPRE8gLSBmaXhcbiAgICAgICAgICAgIEFjY2Vzc1Rva2VuOiAoKF9hID0gZXZlbnQuaGVhZGVycy5BdXRob3JpemF0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3BsaXQoXCIgXCIpWzFdKSB8fCBcIlwiLFxuICAgICAgICAgICAgVXNlckF0dHJpYnV0ZXM6IFVzZXJBdHRyaWJ1dGVzLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCB1cGRhdGVSZXNwb25zZSA9IHlpZWxkIGNvZ25pdG9fMS5jb2duaXRvSWRlbnRpdHlTZXJ2aWNlUHJvdmlkZXJcbiAgICAgICAgICAgIC51cGRhdGVVc2VyQXR0cmlidXRlcyh1cGRhdGVQYXJhbXMpXG4gICAgICAgICAgICAucHJvbWlzZSgpO1xuICAgICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgICAgICBUYWJsZU5hbWU6IHByb2Nlc3MuZW52LkRCX1RBQkxFX05BTUUgfHwgXCJcIixcbiAgICAgICAgICAgIEtleToge1xuICAgICAgICAgICAgICAgIHVzZXJJZDogcmVxdWVzdEJvZHlKc29uLnVzZXJJZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBVcGRhdGVFeHByZXNzaW9uOiB1cGRhdGVFeHByZXNzaW9uLFxuICAgICAgICAgICAgRXhwcmVzc2lvbkF0dHJpYnV0ZVZhbHVlczogZXhwcmVzc2lvbkF0dHJpYnV0ZVZhbHVlcyxcbiAgICAgICAgICAgIFJldHVyblZhbHVlczogXCJBTExfTkVXXCIsXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHlpZWxkIGR5bmFtb0RCXzEuZHluYW1vRGIudXBkYXRlKHBhcmFtcykucHJvbWlzZSgpO1xuICAgICAgICByZXR1cm4gKDAsIGFwaUdldHdheV8xLmNyZWF0ZVJlc3BvbnNlKSgyMDAsIHJlc3VsdC5BdHRyaWJ1dGVzIHx8IHt9KTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiAoMCwgYXBpR2V0d2F5XzEuY3JlYXRlUmVzcG9uc2UpKDUwMCwgeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcbiAgICB9XG59KTtcbmV4cG9ydHMuaGFuZGxlciA9IGhhbmRsZXI7XG5jb25zdCB2YWxpZGF0aW9ucyA9IHtcbiAgICBmaXJzdE5hbWU6ICh2YWx1ZSkgPT4gKDAsIHZhbGlkYXRpb25zXzEudmFsaWRhdGVTdHJpbmdNYXhMZW5ndGgpKHZhbHVlLCAyMCksXG4gICAgbGFzdE5hbWU6ICh2YWx1ZSkgPT4gKDAsIHZhbGlkYXRpb25zXzEudmFsaWRhdGVTdHJpbmdNYXhMZW5ndGgpKHZhbHVlLCAyMCksXG4gICAgcGFzc3dvcmQ6ICh2YWx1ZSkgPT4gKDAsIHZhbGlkYXRpb25zXzEudmFsaWRhdGVTdHJpbmdNYXhMZW5ndGgpKHZhbHVlLCAyMCksXG4gICAgcGhvbmVOdW1iZXI6ICh2YWx1ZSkgPT4gKDAsIHZhbGlkYXRpb25zXzEudmFsaWRhdGVJc3JhZWxpUGhvbmVOdW1iZXIpKHZhbHVlKSxcbiAgICB1c2VySWQ6ICh2YWx1ZSkgPT4gKDAsIHZhbGlkYXRpb25zXzEudmFsaWRhdGVJc3JhZWxpSUQpKHZhbHVlKSxcbn07XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51bmF1dGhvcml6ZWRSZXNwb25zZSA9IGV4cG9ydHMuaXNVc2VyQXV0aGVudGljYXRlZEF1dGhvcml6ZXIgPSBleHBvcnRzLmlzVXNlckF1dGhlbnRpY2F0ZWQgPSB2b2lkIDA7XG5jb25zdCBjb2duaXRvXzEgPSByZXF1aXJlKFwiLi4vYXdzLWNvbmZpZy9jb2duaXRvXCIpO1xuY29uc3QgaXNVc2VyQXV0aGVudGljYXRlZCA9IChldmVudCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IEFjY2Vzc1Rva2VuID0gKF9hID0gZXZlbnQuaGVhZGVycy5BdXRob3JpemF0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3BsaXQoXCIgXCIpWzFdO1xuICAgIGlmICghQWNjZXNzVG9rZW4pXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBjb25zdCBhdXRoUmVzcG9uc2UgPSB5aWVsZCBjb2duaXRvXzEuY29nbml0b0lkZW50aXR5U2VydmljZVByb3ZpZGVyXG4gICAgICAgIC5nZXRVc2VyKHsgQWNjZXNzVG9rZW4gfSlcbiAgICAgICAgLnByb21pc2UoKTtcbiAgICBpZiAoIWF1dGhSZXNwb25zZSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiB0cnVlO1xufSk7XG5leHBvcnRzLmlzVXNlckF1dGhlbnRpY2F0ZWQgPSBpc1VzZXJBdXRoZW50aWNhdGVkO1xuY29uc3QgaXNVc2VyQXV0aGVudGljYXRlZEF1dGhvcml6ZXIgPSAoZXZlbnQpID0+IHtcbiAgICBjb25zdCB1c2VyID0gZXZlbnQucmVxdWVzdENvbnRleHQuYXV0aG9yaXplcjtcbiAgICBpZiAoIXVzZXIpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoIXVzZXIuY2xhaW1zKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIHRydWU7XG59O1xuZXhwb3J0cy5pc1VzZXJBdXRoZW50aWNhdGVkQXV0aG9yaXplciA9IGlzVXNlckF1dGhlbnRpY2F0ZWRBdXRob3JpemVyO1xuZXhwb3J0cy51bmF1dGhvcml6ZWRSZXNwb25zZSA9IHtcbiAgICBzdGF0dXNDb2RlOiA0MDEsXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIixcbiAgICB9KSxcbn07XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudmFsaWRhdGVJc3JhZWxpSUQgPSBleHBvcnRzLnZhbGlkYXRlSXNyYWVsaVBob25lTnVtYmVyID0gZXhwb3J0cy52YWxpZGF0ZVN0cmluZ01pbkxlbmd0aCA9IGV4cG9ydHMudmFsaWRhdGVTdHJpbmdNYXhMZW5ndGggPSBleHBvcnRzLnZhbGlkYXRlUmVxdWVzdCA9IHZvaWQgMDtcbmNvbnN0IHZhbGlkYXRlUmVxdWVzdCA9IChldmVudCwgdmFsaWRhdGlvbnMpID0+IHtcbiAgICBpZiAoIWV2ZW50LmJvZHkpXG4gICAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgbWVzc2FnZTogXCJOb3QgdmFsaWQgcmVxdWVzdCBib2R5XCIgfTtcbiAgICBjb25zdCByZXF1ZXN0Qm9keSA9IEpTT04ucGFyc2UoZXZlbnQuYm9keSk7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gcmVxdWVzdEJvZHkpIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSByZXF1ZXN0Qm9keVtrZXldO1xuICAgICAgICBjb25zdCB2YWxpZGF0aW9uRnVuY3Rpb24gPSB2YWxpZGF0aW9uc1trZXldO1xuICAgICAgICBpZiAodmFsaWRhdGlvbkZ1bmN0aW9uICYmICF2YWxpZGF0aW9uRnVuY3Rpb24odmFsdWUpKVxuICAgICAgICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBtZXNzYWdlOiBgTm90IHZhbGlkICR7a2V5fSAtICR7dmFsdWV9YCB9O1xuICAgIH1cbiAgICByZXR1cm4geyB2YWxpZDogdHJ1ZSB9O1xufTtcbmV4cG9ydHMudmFsaWRhdGVSZXF1ZXN0ID0gdmFsaWRhdGVSZXF1ZXN0O1xuY29uc3QgdmFsaWRhdGVTdHJpbmdNYXhMZW5ndGggPSAodmFsdWUsIGxlbmd0aCkgPT4gdmFsdWUubGVuZ3RoIDwgbGVuZ3RoO1xuZXhwb3J0cy52YWxpZGF0ZVN0cmluZ01heExlbmd0aCA9IHZhbGlkYXRlU3RyaW5nTWF4TGVuZ3RoO1xuY29uc3QgdmFsaWRhdGVTdHJpbmdNaW5MZW5ndGggPSAodmFsdWUsIGxlbmd0aCkgPT4gdmFsdWUubGVuZ3RoID4gbGVuZ3RoO1xuZXhwb3J0cy52YWxpZGF0ZVN0cmluZ01pbkxlbmd0aCA9IHZhbGlkYXRlU3RyaW5nTWluTGVuZ3RoO1xuY29uc3QgdmFsaWRhdGVJc3JhZWxpUGhvbmVOdW1iZXIgPSAocGhvbmVOdW1iZXIpID0+IHtcbiAgICBjb25zdCBwaG9uZVJlZ2V4ID0gL14oMDUpWzAtOV17OH0kLztcbiAgICByZXR1cm4gcGhvbmVSZWdleC50ZXN0KHBob25lTnVtYmVyKTtcbn07XG5leHBvcnRzLnZhbGlkYXRlSXNyYWVsaVBob25lTnVtYmVyID0gdmFsaWRhdGVJc3JhZWxpUGhvbmVOdW1iZXI7XG5jb25zdCB2YWxpZGF0ZUlzcmFlbGlJRCA9IChpZCkgPT4ge1xuICAgIGlkID0gU3RyaW5nKGlkKS50cmltKCk7XG4gICAgaWYgKGlkLmxlbmd0aCA+IDkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZCA9IGlkLmxlbmd0aCA8IDkgPyAoXCIwMDAwMDAwMFwiICsgaWQpLnNsaWNlKC05KSA6IGlkO1xuICAgIHJldHVybiAoQXJyYXkuZnJvbShpZCwgTnVtYmVyKS5yZWR1Y2UoKGNvdW50ZXIsIGRpZ2l0LCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHN0ZXAgPSBkaWdpdCAqICgoaSAlIDIpICsgMSk7XG4gICAgICAgIHJldHVybiBjb3VudGVyICsgKHN0ZXAgPiA5ID8gc3RlcCAtIDkgOiBzdGVwKTtcbiAgICB9KSAlXG4gICAgICAgIDEwID09PVxuICAgICAgICAwKTtcbn07XG5leHBvcnRzLnZhbGlkYXRlSXNyYWVsaUlEID0gdmFsaWRhdGVJc3JhZWxpSUQ7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJhd3Mtc2RrXCIpOyIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18oOTkyKTtcbiJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImNyZWF0ZVJlc3BvbnNlIiwic3RhdHVzQ29kZSIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiX19hd2FpdGVyIiwidGhpcyIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiY3JlYXRlVXNlclBvb2xBbmRBcHBDbGllbnQiLCJjb2duaXRvSWRlbnRpdHlTZXJ2aWNlUHJvdmlkZXIiLCJhd3Nfc2RrXzEiLCJjb25zdGFudHNfMSIsIkNvZ25pdG9JZGVudGl0eVNlcnZpY2VQcm92aWRlciIsInJlZ2lvbiIsImNvZ25pdG9Vc2VyUG9vbFJlZ2lvbiIsImFwaVZlcnNpb24iLCJjb25maWciLCJ1cGRhdGUiLCJ1c2VyUG9vbElkIiwiY29nbml0b1VzZXJQb29sTmFtZSIsIl9hIiwiZXhpc3RpbmdVc2VyUG9vbCIsImxpc3RVc2VyUG9vbHMiLCJNYXhSZXN1bHRzIiwicHJvbWlzZSIsIlVzZXJQb29scyIsImZpbmQiLCJwb29sIiwiTmFtZSIsIkVycm9yIiwiSWQiLCJlcnJvciIsImNvbnNvbGUiLCJQb29sTmFtZSIsIl9iIiwidXNlclBvb2xQYXJhbXMiLCJhc3NpZ24iLCJQb2xpY2llcyIsIlBhc3N3b3JkUG9saWN5IiwiTWluaW11bUxlbmd0aCIsIlJlcXVpcmVVcHBlcmNhc2UiLCJSZXF1aXJlTG93ZXJjYXNlIiwiUmVxdWlyZU51bWJlcnMiLCJSZXF1aXJlU3ltYm9scyIsIlVzZXJuYW1lQXR0cmlidXRlcyIsImNyZWF0ZVVzZXJQb29sIiwiVXNlclBvb2wiLCJhcHBDbGllbnRJZCIsImFwcENsaWVudE5hbWUiLCJfYyIsImV4aXN0aW5nQXBwQ2xpZW50IiwibGlzdFVzZXJQb29sQ2xpZW50cyIsIlVzZXJQb29sSWQiLCJVc2VyUG9vbENsaWVudHMiLCJjbGllbnQiLCJDbGllbnROYW1lIiwiQ2xpZW50SWQiLCJjaGVja0lmVXNlclBvbGxBcHBDbGllbnRFeGlzdHMiLCJjb2duaXRvVXNlclBvb2xBcHBDbGllbnROYW1lIiwiX2QiLCJhcHBDbGllbnRQYXJhbXMiLCJHZW5lcmF0ZVNlY3JldCIsIkFsbG93ZWRPQXV0aEZsb3dzVXNlclBvb2xDbGllbnQiLCJBbGxvd2VkT0F1dGhGbG93cyIsIkFsbG93ZWRPQXV0aFNjb3BlcyIsIkV4cGxpY2l0QXV0aEZsb3dzIiwicHJvY2VzcyIsImVudiIsIkFVVEhfRkxPV19UWVBFIiwiQ2FsbGJhY2tVUkxzIiwiTG9nb3V0VVJMcyIsImNyZWF0ZVVzZXJQb29sQ2xpZW50IiwiVXNlclBvb2xDbGllbnQiLCJjcmVhdGVVc2VyUG9vbEFwcENsaWVudCIsImNvZ25pdG9Vc2VyUG9vbElkIiwiY3JlYXRlVGFibGVJZk5vdEV4aXN0cyIsImR5bmFtb0RiIiwiRHluYW1vREIiLCJEb2N1bWVudENsaWVudCIsImR5bmFtb0RCU2VydmljZSIsImxpc3RUYWJsZXMiLCJUYWJsZU5hbWVzIiwiaW5jbHVkZXMiLCJEQl9UQUJMRV9OQU1FIiwibG9nIiwicGFyYW1zIiwiVGFibGVOYW1lIiwiS2V5U2NoZW1hIiwiQXR0cmlidXRlTmFtZSIsIktleVR5cGUiLCJBdHRyaWJ1dGVEZWZpbml0aW9ucyIsIkF0dHJpYnV0ZVR5cGUiLCJQcm92aXNpb25lZFRocm91Z2hwdXQiLCJSZWFkQ2FwYWNpdHlVbml0cyIsIldyaXRlQ2FwYWNpdHlVbml0cyIsInRhYmxlIiwiY3JlYXRlVGFibGUiLCJoYW5kbGVyIiwiY29nbml0b18xIiwiZHluYW1vREJfMSIsImF1dGhvcml6ZXJfMSIsImFwaUdldHdheV8xIiwidmFsaWRhdGlvbnNfMSIsImJvZHlJbmRleCIsImZpcnN0TmFtZSIsImNvZ25pdG8iLCJkZGIiLCJsYXN0TmFtZSIsInBob25lTnVtYmVyIiwiZXZlbnQiLCJpc1VzZXJBdXRoZW50aWNhdGVkQXV0aG9yaXplciIsInVuYXV0aG9yaXplZFJlc3BvbnNlIiwidmFsaWQiLCJtZXNzYWdlIiwidmFsaWRhdGVSZXF1ZXN0IiwidmFsaWRhdGlvbnMiLCJyZXF1ZXN0Qm9keSIsInJlcXVlc3RCb2R5SnNvbiIsInBhcnNlIiwiZGV0YWlsc1RvVXBkYXRlIiwidXNlcklkIiwiVXNlckF0dHJpYnV0ZXMiLCJleHByZXNzaW9uQXR0cmlidXRlVmFsdWVzIiwidXBkYXRlRXhwcmVzc2lvbiIsImVudHJpZXMiLCJmb3JFYWNoIiwia2V5IiwiaW5kZXgiLCJwdXNoIiwiVmFsdWUiLCJ2YWwiLCJzbGljZSIsInVwZGF0ZVBhcmFtcyIsIkFjY2Vzc1Rva2VuIiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJzcGxpdCIsInVwZGF0ZVVzZXJBdHRyaWJ1dGVzIiwiS2V5IiwiVXBkYXRlRXhwcmVzc2lvbiIsIkV4cHJlc3Npb25BdHRyaWJ1dGVWYWx1ZXMiLCJSZXR1cm5WYWx1ZXMiLCJBdHRyaWJ1dGVzIiwidmFsaWRhdGVTdHJpbmdNYXhMZW5ndGgiLCJwYXNzd29yZCIsInZhbGlkYXRlSXNyYWVsaVBob25lTnVtYmVyIiwidmFsaWRhdGVJc3JhZWxpSUQiLCJpc1VzZXJBdXRoZW50aWNhdGVkIiwiZ2V0VXNlciIsInVzZXIiLCJyZXF1ZXN0Q29udGV4dCIsImF1dGhvcml6ZXIiLCJjbGFpbXMiLCJ2YWxpZGF0ZVN0cmluZ01pbkxlbmd0aCIsInZhbGlkYXRpb25GdW5jdGlvbiIsImxlbmd0aCIsInRlc3QiLCJpZCIsIlN0cmluZyIsInRyaW0iLCJBcnJheSIsImZyb20iLCJOdW1iZXIiLCJyZWR1Y2UiLCJjb3VudGVyIiwiZGlnaXQiLCJpIiwibW9kdWxlIiwicmVxdWlyZSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19leHBvcnRzX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCJdLCJzb3VyY2VSb290IjoiIn0=